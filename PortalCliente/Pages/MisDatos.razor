@page "/mis-datos"
@using MudBlazor
@using System.Net.Http.Json
@inject HttpClient Http

<MudText Typo="Typo.h5" GutterBottom="true">Mis datos</MudText>

<MudGrid>
    <MudItem xs="12" md="8">
        <MudPaper Class="pa-4" Elevation="0">
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudSelect T="string" @bind-Value="personaTipo" Dense="true" FullWidth="true">
                    @foreach (var option in personaOptions)
                    {
                        <MudSelectItem T="string" Value="@option">@option</MudSelectItem>
                    }
                    </MudSelect>
                </MudItem>
                    
                <MudItem xs="12" sm="6">
                    <MudTextField Label="CUIL/CUIT" @bind-Value="cuil" Variant="Variant.Outlined" FullWidth="true" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField Label="Nombre(s)" @bind-Value="nombre" Variant="Variant.Outlined" FullWidth="true" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudTextField Label="Apellido(s)" @bind-Value="apellido" Variant="Variant.Outlined" FullWidth="true" />
                </MudItem>

                <MudItem xs="12" sm="6">
                    <MudTextField Label="Correo electrónico" @bind-Value="email" Variant="Variant.Outlined" FullWidth="true" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudTextField Label="DNI" @bind-Value="dni" Variant="Variant.Outlined" FullWidth="true" />
                </MudItem>
            </MudGrid>
        </MudPaper>

        <MudGrid Class="mt-4">
            <MudItem xs="12" sm="6">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudStack>
                        <MudText Typo="Typo.subtitle2">Teléfono 1</MudText>
                        <MudText Typo="Typo.body2">@telefono1</MudText>
                        <div class="d-flex justify-content-end">
                            <MudIconButton Icon="Icons.Material.Filled.Edit" Color="Color.Default" />
                            <MudIconButton Icon="Icons.Material.Filled.Delete" Color="Color.Default" />
                        </div>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudStack>
                        <MudText Typo="Typo.subtitle2">Teléfono 2</MudText>
                        <MudText Typo="Typo.body2">@telefono2</MudText>
                        <div class="d-flex justify-content-end">
                            <MudIconButton Icon="Icons.Material.Filled.Edit" Color="Color.Default" />
                            <MudIconButton Icon="Icons.Material.Filled.Delete" Color="Color.Default" />
                        </div>
                    </MudStack>
                </MudPaper>
            </MudItem>
        </MudGrid>

        <div class="mt-3 d-flex justify-content-end">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="Icons.Material.Filled.Add">Agregar teléfono</MudButton>
        </div>

        <MudGrid Class="mt-4">
            <MudItem xs="12" sm="6">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.subtitle2">Dirección 1</MudText>
                    <MudText Typo="Typo.body2">@direccion1</MudText>
                    <div class="d-flex justify-content-end">
                        <MudIconButton Icon="Icons.Material.Filled.Edit" Color="Color.Default" />
                        <MudIconButton Icon="Icons.Material.Filled.Delete" Color="Color.Default" />
                    </div>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.subtitle2">Dirección 2</MudText>
                    <MudText Typo="Typo.body2">@direccion2</MudText>
                    <div class="d-flex justify-content-end">
                        <MudIconButton Icon="Icons.Material.Filled.Edit" Color="Color.Default" />
                        <MudIconButton Icon="Icons.Material.Filled.Delete" Color="Color.Default" />
                    </div>
                </MudPaper>
            </MudItem>
        </MudGrid>

        <div class="mt-3 d-flex justify-content-end">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="Icons.Material.Filled.Add">Agregar dirección</MudButton>
        </div>
    </MudItem>

    <MudItem xs="12" md="4">
        <MudPaper Class="pa-4" Elevation="0">
            <MudText Typo="Typo.h6">Resumen</MudText>
            <MudDivider Class="my-2" />
            <MudText Typo="Typo.body2"><b>Nombre:</b> @nombre @apellido</MudText>
            <MudText Typo="Typo.body2"><b>Email:</b> @email</MudText>
            <MudText Typo="Typo.body2"><b>CUIL:</b> @cuil</MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    private string personaTipo = "Persona Física";
    private string nombre = string.Empty;
    private string apellido = string.Empty;
    private string email = string.Empty;
    private string cuil = string.Empty;
    private string dni = string.Empty;

    private string telefono1 = string.Empty;
    private string telefono2 = string.Empty;

    private string direccion1 = string.Empty;
    private string direccion2 = string.Empty;
    private readonly string[] personaOptions = { "Persona Física", "Persona Jurídica" };

    private class MisDatosDto
    {
        public string PersonaTipo { get; set; } = string.Empty;
        public string Nombre { get; set; } = string.Empty;
        public string Apellido { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Cuil { get; set; } = string.Empty;
        public string Dni { get; set; } = string.Empty;
        public string Telefono1 { get; set; } = string.Empty;
        public string Telefono2 { get; set; } = string.Empty;
        public string Direccion1 { get; set; } = string.Empty;
        public string Direccion2 { get; set; } = string.Empty;
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var data = await Http.GetFromJsonAsync<MisDatosDto>("misdatos");
            if (data is not null)
            {
                personaTipo = data.PersonaTipo ?? personaTipo;
                nombre = data.Nombre ?? nombre;
                apellido = data.Apellido ?? apellido;
                email = data.Email ?? email;
                cuil = data.Cuil ?? cuil;
                dni = data.Dni ?? dni;
                telefono1 = data.Telefono1 ?? telefono1;
                telefono2 = data.Telefono2 ?? telefono2;
                direccion1 = data.Direccion1 ?? direccion1;
                direccion2 = data.Direccion2 ?? direccion2;
            }
        }
        catch
        {
            // ignored - keep defaults (or empty) if API fails
        }
    }
}